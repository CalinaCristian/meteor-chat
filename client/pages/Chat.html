<template name="chat">
  {{>nav}}
  {{#if notloggedIn}}
  <div class="alert alert-warning">
    <strong>Warning!</strong> You need to be signed in to access chat!
  </div>
  {{/if}}
	 <div id="sidebar" style="visibility:{{displayType}}">
		  <p style="color:#660066; text-align: center;"> <strong>Online Friends:</strong> </p>
		  {{> users}}
      <p style="color:#660066; text-align: center;"> <strong>Your Groups:</strong> </p>
      {{> groups}}
   </div>
   <div id="primary" style="visibility:{{displayType}}">
   	  <div id="log" > {{>messages}} </div>
      <div id="composer">{{>input}}</div>
	 </div>
<!--   {{lastMessage}}
  {{changeTitle}} -->

</template>

<template name="users">
	{{#each users}}
    {{#if itsme}}
      <p>
      <span style="color:{{getColor this}}" class="glyphicon glyphicon-user"></span>
      <strong style="color:{{getColor this}}"> Me </strong>
      <button type="button" id="startGChat" class="btn btn-default pull-right btn-xs"> Global Chat </button>
      </p>
    {{/if}}
  {{/each}}
  {{#each users}}
    {{#if userIsFriend}}
      <p>
      <span style="color:{{getColor this}}" class="glyphicon glyphicon-user"></span>
      <strong style="color:{{getColor this}}" data-toogle="tooltip" title="{{username}}"> {{getUsername this}} </strong>
      {{#if notInMyGroup}}
      <button type="button" id="addGroup" class="btn btn-default btn-xs pull-right"> Group </button>
      {{/if}}
      <button type="button" id="startChat" class="btn btn-default btn-xs pull-right"> Chat </button>
      </p>
    {{/if}}
	{{/each}}
</template>

<template name="groups">
  {{#each group}}
    {{#if ownerOfGroup}}
      <p>
      <span style="color:red" class="glyphicon glyphicon-subtitles"></span>
      <strong style="color:red" data-toogle="tooltip" title="{{realName}}"> {{name}} </strong>
      <button type="button" id="deleteGroup" class="btn btn-danger btn-xs pull-right"> Delete </button>
      <button type="button" id="startGroupChat" class="btn btn-default btn-xs pull-right"> Chat </button>
      </p>
    {{/if}}
  {{/each}}
  {{#each group}}
    {{#if userInGroup}}
      <p>
      <span style="color:black" class="glyphicon glyphicon-subtitles"></span>
      <strong data-toogle="tooltip" title="{{realName}}"> {{name}} </strong>
      <button type="button" id="leaveGroupChat" class="btn btn-danger btn-xs pull-right"> Leave </button>
      <button type="button" id="startGroupChat" class="btn btn-default btn-xs pull-right"> Chat </button>
      </p>
    {{/if}}
  {{/each}}
  {{#if notOwnsGroup}}
    <form class="createGroup" style="text-align: center;">
      <input type="text" required class="form-control" id="newGroup" name="newGroup" placeholder="Create group..">
      <input type="submit" id="addGroup" class="btn btn-default" value="Submit">
    </form>
  {{/if}}
</template>

<template name="messages">
  {{#each messages}}
    {{>msj}}
  {{/each}}
</template>

<template name="input">
  <div id="inputMessageBox" class="row">
    <div class="col-sm-4 col-md-3 col-lg-3">
      Message({{toWhom}}):
    </div>
    <div class="col-sm-8 col-md-9 col-lg-9">
      <input style="width:99%;" type="text" id="message">
    </div>
  </div>
</template>

<template name="msj">
  {{#if filterThem}}
    {{#if systemMessage}}
      <span class="text">
      <span style="font-size:xx-small"> {{formatDate time "DD.MM.YY"}} </span>
      <span style="font-size:x-small"> <strong>{{formatDate time "HH:mm"}} </strong>  </span>
      <i> <strong style="color:black"> System Message: </strong> {{message}} <br></i></span>
    {{else}}
      <span class="text">
      <span style="font-size:xx-small"> {{formatDate time "DD.MM.YY"}} </span>
      <span style="font-size:x-small"> <strong>{{formatDate time "HH:mm"}} </strong>  </span>
      <span style="color:{{myColorChat this}}" class="glyphicon glyphicon-user"> </span>
      <strong style="color:{{myColorChat this}}"> {{name}}:</strong> {{message}} <br></span>
    {{/if}}
  {{/if}}
</template>
